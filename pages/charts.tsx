import React from 'react';
import ReactECharts from 'echarts-for-react';

// 生成 ["04:00", "04:10", ... "23:50", "00:00", ... "03:50"]
function getTimeXAxis() {
    let out = []
    for (let i = 0; i < 24; i++) {
        for (let j = 0; j < 6; j++) {
            out.push(`${i.toString().padStart(2, '0')}:${(j * 10).toString().padStart(2, '0')}`)
        }
    }
    out = out.concat(out.splice(out.length-24, 24))
    console.log(out)
    return out
}

function getUserMsgCount(data: any) {
    // {user1:1,user2:4 ...}
    const userMsgCount = data.user_msg_stat
    const out: { name: string; value: any; }[] = []
    Object.keys(userMsgCount).forEach((key) => {
        out.push({name: key, value: userMsgCount[key].MsgCount})
    })
    out.sort((a, b) => {
        return -(b.value - a.value)
    })
    return out
}
function getUserMsgLen(data: any) {
    // {user1:1,user2:4 ...}
    const userMsgCount = data.user_msg_stat
    const out: { name: string; value: any; }[] = []
    Object.keys(userMsgCount).forEach((key) => {
        out.push({name: key, value: userMsgCount[key].MsgLen})
    })
    out.sort((a, b) => {
        return -(b.value - a.value)
    })
    return out
}
export default function MCharts(props: any) {
    // echarts.use([GridComponent, BarChart, CanvasRenderer]);
    // 在组件的范围内定义 options 对象
    const data = {
        "last_day": {
            "message_count": 624,
            "photo_count": 96,
            "sticker_count": 57,
            "forward_count": 5,
            "user_msg_stat": {
                "1029720021": {
                    "MsgCount": 21,
                    "MsgLen": 273
                },
                "1041270924": {
                    "MsgCount": 3,
                    "MsgLen": 7
                },
                "1269085135": {
                    "MsgCount": 9,
                    "MsgLen": 154
                },
                "199456161": {
                    "MsgCount": 123,
                    "MsgLen": 1972
                },
                "342383968": {
                    "MsgCount": 6,
                    "MsgLen": 60
                },
                "5113197550": {
                    "MsgCount": 1,
                    "MsgLen": 2
                },
                "527000261": {
                    "MsgCount": 33,
                    "MsgLen": 288
                },
                "5565677431": {
                    "MsgCount": 8,
                    "MsgLen": 141
                },
                "6659890828": {
                    "MsgCount": 4,
                    "MsgLen": 21
                },
                "709763821": {
                    "MsgCount": 3,
                    "MsgLen": 29
                },
                "733155751": {
                    "MsgCount": 6,
                    "MsgLen": 32
                },
                "735073652": {
                    "MsgCount": 78,
                    "MsgLen": 860
                },
                "754265124": {
                    "MsgCount": 14,
                    "MsgLen": 68
                },
                "764575148": {
                    "MsgCount": 86,
                    "MsgLen": 1050
                },
                "814428600": {
                    "MsgCount": 223,
                    "MsgLen": 2077
                },
                "839667127": {
                    "MsgCount": 6,
                    "MsgLen": 58
                }
            },
            "msg_count_by_time": [
                6,
                25,
                28,
                7,
                3,
                4,
                6,
                0,
                3,
                1,
                0,
                0,
                1,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1,
                1,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                2,
                1,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                2,
                0,
                0,
                1,
                0,
                5,
                1,
                0,
                0,
                0,
                6,
                3,
                2,
                5,
                6,
                1,
                12,
                20,
                6,
                4,
                0,
                17,
                13,
                4,
                4,
                11,
                26,
                21,
                9,
                10,
                8,
                1,
                2,
                0,
                5,
                4,
                2,
                3,
                0,
                1,
                0,
                1,
                4,
                2,
                0,
                5,
                11,
                8,
                1,
                4,
                5,
                29,
                32,
                10,
                3,
                8,
                9,
                0,
                2,
                0,
                9,
                2,
                2,
                0,
                0,
                4,
                3,
                19,
                6,
                3,
                3,
                0,
                4,
                0,
                0,
                4,
                0,
                0,
                0,
                0,
                12,
                6,
                2,
                0,
                7,
                6,
                4,
                3,
                11,
                6,
                13,
                17,
                13,
                8,
                4,
                15
            ],
            "msg_id_at_time_start": [
                1505680,
                1505686,
                1505711,
                1505739,
                1505747,
                1505750,
                1505754,
                0,
                1505760,
                1505763,
                0,
                0,
                1505764,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1505765,
                1505766,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1505118,
                1505120,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1505122,
                0,
                0,
                1505124,
                0,
                1505125,
                1505130,
                0,
                0,
                0,
                1505131,
                1505138,
                1505141,
                1505143,
                1505148,
                1505154,
                1505156,
                1505171,
                1505193,
                1505200,
                0,
                1505204,
                1505222,
                1505235,
                1505239,
                1505243,
                1505255,
                1505281,
                1505302,
                1505311,
                1505323,
                1505331,
                1505332,
                0,
                1505335,
                1505340,
                1505344,
                1505346,
                0,
                1505349,
                0,
                1505350,
                1505353,
                1505357,
                0,
                1505359,
                1505364,
                1505375,
                1505383,
                1505384,
                1505388,
                1505393,
                1505422,
                1505454,
                1505465,
                1505469,
                1505478,
                0,
                1505487,
                0,
                1505489,
                1505498,
                1505500,
                0,
                0,
                1505502,
                1505507,
                1505510,
                1505529,
                1505536,
                1505539,
                0,
                1505542,
                0,
                0,
                1505546,
                0,
                0,
                0,
                0,
                1505550,
                1505562,
                1505568,
                0,
                1505571,
                1505578,
                1505586,
                1505590,
                1505593,
                1505604,
                1505610,
                1505623,
                1505640,
                1505653,
                1505661,
                1505666
            ],
            "mars_count": 1,
            "max_mars_count": 1,
            "racy_count": 3,
            "adult_count": 1,
            "download_video_count": 5,
            "download_audio_count": 0,
            "dio_add_user_count": 0,
            "dio_ban_user_count": 0
        },
        "today": {
            "message_count": 962,
            "photo_count": 114,
            "sticker_count": 92,
            "forward_count": 0,
            "user_msg_stat": {
                "1029720021": {
                    "MsgCount": 34,
                    "MsgLen": 666
                },
                "1041270924": {
                    "MsgCount": 7,
                    "MsgLen": 99
                },
                "1269085135": {
                    "MsgCount": 39,
                    "MsgLen": 185
                },
                "199456161": {
                    "MsgCount": 206,
                    "MsgLen": 2786
                },
                "342383968": {
                    "MsgCount": 37,
                    "MsgLen": 328
                },
                "527000261": {
                    "MsgCount": 17,
                    "MsgLen": 722
                },
                "5507034607": {
                    "MsgCount": 1,
                    "MsgLen": 0
                },
                "5782151654": {
                    "MsgCount": 4,
                    "MsgLen": 29
                },
                "6071804242": {
                    "MsgCount": 3,
                    "MsgLen": 24
                },
                "681893936": {
                    "MsgCount": 7,
                    "MsgLen": 0
                },
                "733155751": {
                    "MsgCount": 4,
                    "MsgLen": 36
                },
                "735073652": {
                    "MsgCount": 131,
                    "MsgLen": 1186
                },
                "754265124": {
                    "MsgCount": 50,
                    "MsgLen": 1136
                },
                "764575148": {
                    "MsgCount": 119,
                    "MsgLen": 1354
                },
                "814428600": {
                    "MsgCount": 301,
                    "MsgLen": 2367
                },
                "988854401": {
                    "MsgCount": 2,
                    "MsgLen": 17
                }
            },
            "msg_count_by_time": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                3,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                2,
                0,
                0,
                0,
                0,
                0,
                0,
                1,
                0,
                0,
                0,
                0,
                0,
                1,
                0,
                1,
                0,
                0,
                0,
                1,
                2,
                2,
                2,
                1,
                0,
                6,
                8,
                5,
                4,
                2,
                10,
                2,
                4,
                4,
                3,
                7,
                18,
                10,
                13,
                0,
                0,
                5,
                2,
                0,
                0,
                0,
                1,
                0,
                3,
                0,
                0,
                14,
                9,
                2,
                6,
                7,
                27,
                34,
                36,
                47,
                10,
                8,
                20,
                19,
                13,
                16,
                7,
                5,
                0,
                39,
                46,
                27,
                29,
                7,
                1,
                2,
                7,
                3,
                3,
                9,
                40,
                43,
                27,
                5,
                12,
                23,
                18,
                0,
                18,
                17,
                15,
                9,
                29,
                39,
                39,
                35,
                17,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ],
            "msg_id_at_time_start": [
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1505767,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                1505770,
                0,
                0,
                0,
                0,
                0,
                0,
                1505772,
                0,
                0,
                0,
                0,
                0,
                1505773,
                0,
                1505775,
                0,
                0,
                0,
                1505776,
                1505777,
                1505779,
                1505781,
                1505783,
                0,
                1505784,
                1505790,
                1505798,
                1505803,
                1505807,
                1505809,
                1505819,
                1505821,
                1505825,
                1505829,
                1505832,
                1505839,
                1505859,
                1505869,
                0,
                0,
                1505883,
                1505888,
                0,
                0,
                0,
                1505890,
                0,
                1505891,
                0,
                0,
                1505895,
                1505912,
                1505922,
                1505925,
                1505932,
                1505941,
                1505969,
                1506003,
                1506040,
                1506088,
                1506098,
                1506108,
                1506129,
                1506148,
                1506165,
                1506181,
                1506189,
                0,
                1506196,
                1506237,
                1506283,
                1506310,
                1506339,
                1506346,
                1506347,
                1506349,
                1506356,
                1506359,
                1506362,
                1506371,
                1506411,
                1506454,
                1506481,
                1506488,
                1506502,
                1506526,
                0,
                1506545,
                1506563,
                1506581,
                1506596,
                1506605,
                1506634,
                1506673,
                1506712,
                1506747,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0,
                0
            ],
            "mars_count": 4,
            "max_mars_count": 1,
            "racy_count": 0,
            "adult_count": 2,
            "download_video_count": 9,
            "download_audio_count": 0,
            "dio_add_user_count": 0,
            "dio_ban_user_count": 1
        },
        "last_update": "2023-12-06T04:12:34.767337999+08:00",
        "next_update": "2023-12-07T04:00:00+08:00"
    }
    const options = {
        grid: {top: 8, right: 8, bottom: 24, left: 36},
        xAxis: {
            type: 'category',
            data: getTimeXAxis(),
        },
        yAxis: {
            type: 'value',
        },
        series: [
            {
                data: data.last_day.msg_count_by_time,
                type: 'bar',
                smooth: true,
            },
        ],
        tooltip: {
            trigger: 'axis',
        },
    };
    const options2 = {
        grid: {top: 8, right: 8, bottom: 24, left: 36},

        series: [
            {
                type: 'pie',
                smooth: true,
                data: getUserMsgCount(data.last_day),
            },
        ],
        tooltip: {
            trigger: 'axis',
        },
    };
    const options3 = {
        grid: {top: 8, right: 8, bottom: 24, left: 36},

        series: [
            {
                type: 'pie',
                smooth: true,
                data: getUserMsgLen(data.last_day),
            },
        ],
        tooltip: {
            trigger: 'axis',
        },
    };
    return <>
        <div>test</div>
        <div>
            <ReactECharts option={options} style={{height: 400, width: 700}}/>
            <ReactECharts option={options2} style={{height: 400, width: 700}}/>
            <ReactECharts option={options3} style={{height: 400, width: 700}}/>
        </div>
    </>;
}